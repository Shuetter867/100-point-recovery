<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recovery Dashboard - 200-Point Daily</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .activity {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
    }
    .activity input[type="checkbox"] {
      transform: scale(1.5);
    }
    .summary {
      margin-top: 30px;
      font-size: 1.4em;
      text-align: center;
      padding: 15px;
      border-radius: 8px;
    }
    .green { background-color: #d4edda; color: #155724; }
    .amber { background-color: #fff3cd; color: #856404; }
    .red { background-color: #f8d7da; color: #721c24; }
    #historyChart {
      width: 100%;
      height: 200px;
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <h1>Daily Recovery – 200 Point Target</h1>
  <div id="activitiesContainer"></div>
  <button onclick="saveDay()">Save Day</button>
  <div class="summary" id="dailySummary">Today’s Points: 0</div>

  <canvas id="historyChart"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const activities = [
      { label: '8+ hours sleep', pts: 30 },
      { label: 'Nutrition target met', pts: 25 },
      { label: 'Hydration target met', pts: 20 },
      { label: 'Warm-down + foam-roll', pts: 15 },
      { label: 'Cold/hot contrast therapy', pts: 20 },
      { label: 'Mobility/stretching (20-30 min)', pts: 15 },
      { label: 'Active recovery session (light)', pts: 10 },
      { label: 'Mental recovery (meditation/journal)', pts: 15 },
      { label: 'Readiness check (HRV / self-rating)', pts: 10 },
      { label: 'Compression / passive recovery', pts: 10 },
      { label: 'Low-stress lifestyle time off screens', pts: 10 }
    ];
    const targetPoints = 200;

    const container = document.getElementById('activitiesContainer');
    activities.forEach((act, idx) => {
      const div = document.createElement('div');
      div.className = 'activity';
      div.innerHTML = `
        <label><input type="checkbox" id="chk-${idx}"/> ${act.label} (${act.pts} pts)</label>
      `;
      container.appendChild(div);
    });

    function calculatePoints() {
      let total = 0;
      activities.forEach((act, idx) => {
        const checked = document.getElementById(`chk-${idx}`).checked;
        if (checked) total += act.pts;
      });
      return total;
    }

    function saveDay() {
      const total = calculatePoints();
      const todayKey = new Date().toISOString().slice(0,10);
      let history = JSON.parse(localStorage.getItem('history') || '{}');
      history[todayKey] = total;
      localStorage.setItem('history', JSON.stringify(history));

      updateSummary(total);
      drawChart(history);
    }

    function updateSummary(total) {
      const summaryDiv = document.getElementById('dailySummary');
      summaryDiv.innerText = `Today’s Points: ${total}`;
      if (total >= targetPoints) {
        summaryDiv.className = 'summary green';
      } else if (total >= targetPoints * 0.75) {
        summaryDiv.className = 'summary amber';
      } else {
        summaryDiv.className = 'summary red';
      }
    }

    function drawChart(history) {
      const ctx = document.getElementById('historyChart').getContext('2d');
      const labels = Object.keys(history).sort().slice(-7);
      const data = labels.map(d => history[d]);

      if (window.myChart) window.myChart.destroy();
      window.myChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Daily Recovery Points',
            data: data,
            backgroundColor: data.map(val => val >= targetPoints ? '#28a745' : (val >= targetPoints*0.75 ? '#ffc107' : '#dc3545'))
          }]
        },
        options: {
          scales: {
            y: { beginAtZero: true, max: targetPoints + 20 }
          }
        }
      });
    }

    window.onload = () => {
      const history = JSON.parse(localStorage.getItem('history') || '{}');
      const todayKey = new Date().toISOString().slice(0,10);
      if (history[todayKey] != null) {
        // pre-check boxes for previous saved day? (optional)
      }
      drawChart(history);
    };
  </script>
</body>
</html>
